load("@rules_foreign_cc//foreign_cc:defs.bzl", "cmake")

package(default_visibility = ["//visibility:private"])

licenses(["notice"])

cc_library(
    name = "assimp",
    deps = [
        ":assimp_include",
        ":assimp_lib",
    ],
    visibility = ["//visibility:public"],
)

cc_library(
    name = "assimp_include",
    hdrs = glob(["include/**"]),
    strip_include_prefix = "include",
    include_prefix = "third_party",
)

cmake(
    name = "assimp_lib",
    lib_source = "@lib-assimp-all-srcs//:all_srcs",
    generate_args = [
        "-D CMAKE_BUILD_TYPE=Release",
        "-D BUILD_SHARED_LIBS=OFF",
        "-D ASSIMP_NO_EXPORT=ON",
        "-D ASSIMP_BUILD_ASSIMP_TOOLS=OFF",
        "-D ASSIMP_BUILD_TESTS=OFF",
        "-D ASSIMP_INSTALL_PDB=OFF",
        "-D ASSIMP_BUILD_ALL_IMPORTERS_BY_DEFAULT=OFF",
        "-D ASSIMP_BUILD_OBJ_IMPORTER=ON",
    ],
    out_static_libs = ["libassimp.a"],
)
